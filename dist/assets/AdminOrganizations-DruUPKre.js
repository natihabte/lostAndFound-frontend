import{u as oe,r as i,j as e}from"./index-Iy8zicZ9.js";const xe=({darkMode:s,currentUser:u})=>{var L,E,R,P,_,F,U,G,J,B,q,Y;const{t:le}=oe(),[d,h]=i.useState([]),[z,C]=i.useState(!0),[m,K]=i.useState(""),[b,V]=i.useState("all"),[y,Q]=i.useState("all"),[g,W]=i.useState(null),[X,$]=i.useState(!1),[ie,ce]=i.useState(!1),[Z,w]=i.useState(!1),[N,D]=i.useState(null),[x,I]=i.useState({}),[A,k]=i.useState(!1),[S,M]=i.useState({}),ee=["university","municipality","hospital","transport","government","other"],te=["all","pending","active","suspended","rejected"];i.useEffect(()=>{if(O(),M({timestamp:new Date().toISOString(),localStorage:{token:localStorage.getItem("token")?"Present":"Missing",user:localStorage.getItem("user")?"Present":"Missing",userRole:localStorage.getItem("userRole")||"Missing"},currentUser:u||"Not provided",windowLocation:window.location.href}),!u){const t=localStorage.getItem("user"),a=localStorage.getItem("token");if(t&&a)try{const r=JSON.parse(t);console.log("ðŸ”„ Fallback authentication: Found stored user",r),fetch("http://localhost:5001/api/organizations",{method:"GET",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}}).then(n=>{n.ok?console.log("âœ… Stored token is valid, user should be authenticated"):(console.log("âŒ Stored token is invalid, clearing localStorage"),localStorage.clear())}).catch(n=>{console.log("âŒ Token validation failed:",n)})}catch(r){console.error("Error parsing stored user:",r),localStorage.clear()}else console.log("âš ï¸ No authentication data found. User needs to login.")}},[u]),i.useEffect(()=>{d.length>0&&j()},[d]);const O=async()=>{try{C(!0);let t=localStorage.getItem("token");if(!t){console.error("No auth token found in localStorage"),console.log("Available localStorage keys:",Object.keys(localStorage)),localStorage.getItem("user")&&console.log("User data found but no token. User may need to re-login."),h([]);return}console.log("Making API request with token:",t.substring(0,30)+"...");const a=await fetch("http://localhost:5001/api/organizations",{method:"GET",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(console.log("API Response Status:",a.status),console.log("API Response OK:",a.ok),a.ok){const r=await a.json();console.log("Organizations fetched successfully:",r);const n=r.data||r.organizations||r,o=Array.isArray(n)?n:[];console.log("Raw organizations data:",o),console.log("Organizations count:",o.length);const c=o.map(l=>{var p,H;return{_id:l._id,name:l.name,organizationId:l.organizationId,type:l.type,sectorLevel:l.sectorLevel,status:l.isActive?"active":"pending",verificationStatus:l.verificationStatus,contact:{email:(p=l.contact)==null?void 0:p.email,phone:(H=l.contact)==null?void 0:H.phone},createdAt:l.createdAt||l.registrationDate,adminId:l.adminId}});console.log("Transformed organizations:",c),h(c),setTimeout(()=>{j()},100)}else{console.error("Failed to fetch organizations:",a.status,a.statusText);try{const r=await a.json();if(console.error("Error details:",r),a.status===401)console.error("Authentication failed - token may be expired"),localStorage.removeItem("token");else if(a.status===403){console.error("Access denied - user may not have permission to view organizations");const n=localStorage.getItem("user");if(n){const o=JSON.parse(n);console.error("Current user role:",o.role)}}}catch(r){console.error("Could not parse error response:",r)}h([])}}catch(t){console.error("Error fetching organizations:",t),console.error("Error details:",{message:t.message,stack:t.stack,name:t.name}),t.message.includes("fetch")&&console.error("Network error - backend server may not be running on http://localhost:5001"),h([])}finally{C(!1)}},j=async()=>{try{const t=d.length,a=d.filter(c=>c.status==="active").length,r=d.filter(c=>c.status==="pending").length,n=d.filter(c=>c.status==="suspended").length,o={organizations:{total:t,active:a,pending:r,suspended:n}};console.log("Stats calculated:",o),I(o)}catch(t){console.error("Error calculating stats:",t),I({organizations:{total:0,active:0,pending:0,suspended:0}})}},f=async(t,a,r="")=>{try{h(n=>n.map(o=>o._id===t?{...o,status:a}:o)),alert(`Organization status updated to ${a}`),await j()}catch(n){console.error("Error updating status:",n),alert("Error updating status")}},se=async(t,a=null)=>{try{h(r=>r.filter(n=>n._id!==t)),w(!1),D(null),alert("Organization deleted successfully"),await j()}catch(r){console.error("Error deleting organization:",r),alert("Error deleting organization")}},T=d.filter(t=>{var o,c,l,p;const a=((o=t.name)==null?void 0:o.toLowerCase().includes(m.toLowerCase()))||((c=t.organizationId)==null?void 0:c.toLowerCase().includes(m.toLowerCase()))||((p=(l=t.contact)==null?void 0:l.email)==null?void 0:p.toLowerCase().includes(m.toLowerCase())),r=b==="all"||t.status===b,n=y==="all"||t.type===y;return a&&r&&n}),ae=t=>{switch(t){case"active":return;case"pending":return;case"suspended":return;case"rejected":return;default:return}},re=t=>{switch(t){case"active":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200";case"pending":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200";case"suspended":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200";case"rejected":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200";default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200"}},v=({title:t,value:a,icon:r,color:n="text-blue-600"})=>e.jsx("div",{className:`${s?"bg-gray-800 border-gray-700":"bg-white border-gray-200"} border rounded-lg p-6`,children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${s?"text-gray-400":"text-gray-600"}`,children:t}),e.jsx("p",{className:`text-2xl font-bold ${s?"text-white":"text-gray-900"} mt-1`,children:a})]})})}),ne=({org:t})=>{var a,r;return e.jsxs("div",{className:`${s?"bg-gray-800 border-gray-700":"bg-white border-gray-200"} border rounded-lg p-6 hover:shadow-lg transition-shadow`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center space-x-2 mb-2",children:e.jsx("h3",{className:`text-lg font-semibold ${s?"text-white":"text-gray-900"}`,children:t.name})}),e.jsxs("p",{className:`text-sm ${s?"text-gray-400":"text-gray-600"} mb-2`,children:["ID: ",t.organizationId]}),e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[ae(t.status),e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${re(t.status)}`,children:t.status}),e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${s?"bg-gray-700 text-gray-300":"bg-gray-100 text-gray-700"}`,children:t.type})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>{W(t),$(!0)},className:"p-2 text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition-colors",title:"View Details"}),t.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>f(t._id,"active"),className:"p-2 text-green-600 hover:bg-green-50 dark:hover:bg-green-900/20 rounded-lg transition-colors",title:"Approve"}),e.jsx("button",{onClick:()=>{const n=prompt("Reason for rejection:");n&&f(t._id,"rejected",n)},className:"p-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",title:"Reject"})]}),t.status==="active"&&e.jsx("button",{onClick:()=>{const n=prompt("Reason for suspension:");n&&f(t._id,"suspended",n)},className:"p-2 text-yellow-600 hover:bg-yellow-50 dark:hover:bg-yellow-900/20 rounded-lg transition-colors",title:"Suspend"}),t.status==="suspended"&&e.jsx("button",{onClick:()=>f(t._id,"active"),className:"p-2 text-green-600 hover:bg-green-50 dark:hover:bg-green-900/20 rounded-lg transition-colors",title:"Reactivate"}),e.jsx("button",{onClick:()=>{D(t),w(!0)},className:"p-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",title:"Delete"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:`${s?"text-gray-400":"text-gray-600"}`,children:"Email:"}),e.jsx("p",{className:`${s?"text-white":"text-gray-900"} truncate`,children:(a=t.contact)==null?void 0:a.email})]}),e.jsxs("div",{children:[e.jsx("span",{className:`${s?"text-gray-400":"text-gray-600"}`,children:"Phone:"}),e.jsx("p",{className:`${s?"text-white":"text-gray-900"}`,children:(r=t.contact)==null?void 0:r.phone})]}),e.jsxs("div",{children:[e.jsx("span",{className:`${s?"text-gray-400":"text-gray-600"}`,children:"Sector:"}),e.jsx("p",{className:`${s?"text-white":"text-gray-900"}`,children:t.sectorLevel})]}),e.jsxs("div",{children:[e.jsx("span",{className:`${s?"text-gray-400":"text-gray-600"}`,children:"Created:"}),e.jsx("p",{className:`${s?"text-white":"text-gray-900"}`,children:new Date(t.createdAt).toLocaleDateString()})]})]})]})};return z?e.jsx("div",{className:`min-h-screen ${s?"bg-gray-900":"bg-gray-50"} p-6`,children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})})})}):localStorage.getItem("token")?e.jsx("div",{className:`min-h-screen ${s?"bg-gray-900":"bg-gray-50"} p-6`,children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:`text-3xl font-bold ${s?"text-white":"text-gray-900"}`,children:"Organization Management"}),e.jsx("p",{className:`mt-2 ${s?"text-gray-400":"text-gray-600"}`,children:"Manage and control all organizations in the system"})]}),e.jsx("button",{onClick:()=>alert("Create Organization feature coming soon!"),className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:e.jsx("span",{children:"Create Organization"})})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[e.jsx(v,{title:"Total Organizations",value:((L=x.organizations)==null?void 0:L.total)||0,color:"text-blue-600"}),e.jsx(v,{title:"Active",value:((E=x.organizations)==null?void 0:E.active)||0,color:"text-green-600"}),e.jsx(v,{title:"Pending Approval",value:((R=x.organizations)==null?void 0:R.pending)||0,color:"text-yellow-600"}),e.jsx(v,{title:"Suspended",value:((P=x.organizations)==null?void 0:P.suspended)||0,color:"text-red-600"})]}),e.jsx("div",{className:`${s?"bg-gray-800":"bg-white"} rounded-lg shadow p-6 mb-6`,children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"relative",children:e.jsx("input",{type:"text",placeholder:"Search organizations...",value:m,onChange:t=>K(t.target.value),className:`w-full pl-10 pr-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${s?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`})}),e.jsx("select",{value:b,onChange:t=>V(t.target.value),className:`px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${s?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`,children:te.map(t=>e.jsx("option",{value:t,children:t==="all"?"All Status":t.charAt(0).toUpperCase()+t.slice(1)},t))}),e.jsxs("select",{value:y,onChange:t=>Q(t.target.value),className:`px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${s?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`,children:[e.jsx("option",{value:"all",children:"All Types"}),ee.map(t=>e.jsx("option",{value:t,children:t.charAt(0).toUpperCase()+t.slice(1)},t))]})]})}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:T.map(t=>e.jsx(ne,{org:t},t._id))}),T.length===0&&e.jsxs("div",{className:`${s?"bg-gray-800":"bg-white"} rounded-lg shadow p-12 text-center`,children:[e.jsx("h3",{className:`text-lg font-medium ${s?"text-white":"text-gray-900"} mb-2`,children:"No organizations found"}),e.jsx("p",{className:`${s?"text-gray-400":"text-gray-600"}`,children:m||b!=="all"||y!=="all"?"Try adjusting your search or filters":"No organizations have been registered yet"})]}),X&&g&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:`${s?"bg-gray-800":"bg-white"} rounded-lg max-w-2xl w-full p-6`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("h2",{className:`text-xl font-bold ${s?"text-white":"text-gray-900"}`,children:g.name}),e.jsx("button",{onClick:()=>$(!1),className:`${s?"text-gray-400 hover:text-gray-200":"text-gray-600 hover:text-gray-800"}`})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Organization ID:"})," ",g.organizationId]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Type:"})," ",g.type]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Sector Level:"})," ",g.sectorLevel]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Status:"})," ",g.status]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Email:"})," ",(_=g.contact)==null?void 0:_.email]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Phone:"})," ",(F=g.contact)==null?void 0:F.phone]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Created:"})," ",new Date(g.createdAt).toLocaleDateString()]})]})]})}),Z&&N&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:`${s?"bg-gray-800":"bg-white"} rounded-lg max-w-md w-full p-6`,children:[e.jsx("h2",{className:`text-xl font-bold ${s?"text-white":"text-gray-900"} mb-4`,children:"Delete Organization"}),e.jsxs("p",{className:`${s?"text-gray-300":"text-gray-600"} mb-6`,children:["Are you sure you want to delete ",e.jsx("strong",{children:N.name}),"? This action cannot be undone."]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>w(!1),className:`px-4 py-2 border rounded-lg ${s?"border-gray-600 text-gray-300 hover:bg-gray-700":"border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:"Cancel"}),e.jsx("button",{onClick:()=>se(N._id),className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:"Delete"})]})]})}),e.jsxs("div",{className:"fixed bottom-4 right-4 z-50",children:[e.jsx("button",{onClick:()=>k(!A),className:"bg-red-600 text-white px-3 py-2 rounded-lg text-sm hover:bg-red-700 transition-colors",title:"Debug Panel",children:"ðŸ› Debug"}),A&&e.jsxs("div",{className:`absolute bottom-12 right-0 w-96 max-h-96 overflow-y-auto ${s?"bg-gray-800 border-gray-700":"bg-white border-gray-200"} border rounded-lg shadow-lg p-4`,children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h3",{className:`font-bold ${s?"text-white":"text-gray-900"}`,children:"Debug Info"}),e.jsx("button",{onClick:()=>k(!1),className:`${s?"text-gray-400 hover:text-gray-200":"text-gray-600 hover:text-gray-800"}`,children:"âœ•"})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Organizations Count:"})," ",d.length]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Loading:"})," ",z?"Yes":"No"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Token:"})," ",(U=S.localStorage)==null?void 0:U.token]}),e.jsxs("div",{children:[e.jsx("strong",{children:"User Role:"})," ",(G=S.localStorage)==null?void 0:G.userRole]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Current User:"})," ",(u==null?void 0:u.name)||"None"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Stats:"})," T:",((J=x.organizations)==null?void 0:J.total)||0,", A:",((B=x.organizations)==null?void 0:B.active)||0,", P:",((q=x.organizations)==null?void 0:q.pending)||0,", S:",((Y=x.organizations)==null?void 0:Y.suspended)||0]}),e.jsx("button",{onClick:()=>{console.log("=== MANUAL DEBUG ==="),console.log("Organizations:",d),console.log("Stats:",x),console.log("Debug Info:",S),console.log("localStorage token:",localStorage.getItem("token")),console.log("localStorage user:",localStorage.getItem("user")),console.log("Current User:",u),O()},className:"w-full bg-blue-600 text-white px-3 py-1 rounded text-xs hover:bg-blue-700 transition-colors",children:"Refresh & Log Debug"}),e.jsx("button",{onClick:()=>{localStorage.clear(),window.location.reload()},className:"w-full bg-red-600 text-white px-3 py-1 rounded text-xs hover:bg-red-700 transition-colors",children:"Clear Storage & Reload"})]})]})]})]})}):e.jsx("div",{className:`min-h-screen ${s?"bg-gray-900":"bg-gray-50"} p-6`,children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:`${s?"bg-gray-800 border-gray-700":"bg-white border-gray-200"} border rounded-lg p-8 text-center max-w-md`,children:[e.jsx("h3",{className:`text-lg font-medium ${s?"text-white":"text-gray-900"} mb-4`,children:"ðŸ” Authentication Required"}),e.jsx("p",{className:`${s?"text-gray-400":"text-gray-600"} mb-6`,children:"You need to be logged in as an admin to view organizations."}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:async()=>{try{console.log("ðŸ”„ Attempting login...");const t=await fetch("http://localhost:5001/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:"admin@system.com",password:"admin123"})});console.log("ðŸ“¡ Response status:",t.status);const a=await t.json();console.log("ðŸ“Š Response data:",a),t.ok&&a.success?(localStorage.setItem("token",a.token),localStorage.setItem("user",JSON.stringify(a.user)),localStorage.setItem("userRole",a.user.role),console.log("âœ… Login successful, reloading..."),window.location.reload()):(console.error("âŒ Login failed:",a.message),alert("Login failed: "+(a.message||"Unknown error")))}catch(t){console.error("âŒ Login error:",t),alert("Login error: "+t.message+`

Make sure backend is running on port 5001`)}},className:"w-full bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors font-medium",children:"ðŸš€ Auto-Login as Hall Admin"}),e.jsx("button",{onClick:()=>{window.location.href="/"},className:"w-full bg-gray-600 text-white px-6 py-3 rounded-lg hover:bg-gray-700 transition-colors font-medium",children:"ðŸ”‘ Go to Admin Login"})]}),e.jsx("p",{className:`text-xs ${s?"text-gray-500":"text-gray-400"} mt-4`,children:"Auto-login uses admin@system.com / admin123"})]})})})})};export{xe as default};
//# sourceMappingURL=AdminOrganizations-DruUPKre.js.map
